# Generate data

:::note Experimental

This is a preview feature. We would love your [feedback!](https://app.snaplet.dev/chat)

:::

## Understanding seed data

Seed data is a useful tool in software development, providing an initial set of data for your database.

Here's why it's beneficial:

- **Development:** Provides a consistent dataset for developers.
- **Testing:** Ensures predictability when verifying features.
- **Demonstration:** Showcases your software's abilities with example content.
- **Default Data:** Adds necessary built-ins, like country lists.
- **Onboarding:** Gives new users a filled-out starting point.
- **Performance:** Helps simulate heavy usage scenarios.
- **Guides:** Common reference in tutorials.

While seed data might be the unsung hero of early development, it can get a bit needy as software evolves. But don't sweat it! Our mission is to save you from the never-ending saga of maintaining those seed scripts. Who has time for that, right?

## The Snaplet Data Client

The key to effortless seed data is a tool that deeply understands your database's schema. By introspecting your database, we create a fully-typed client dedicated to data generation.

Right now, the Snaplet Data Client is tied to our configuration file, but we intend to generate a standalone version that you will be able to use anywhere!

### Getting started

Before using `snaplet generate`, you'll need:

1. To have set up the snaplet CLI
2. A database with an existing structure in it
3. A generate `plan` in your `snaplet.config.ts` config

#### Setting up the snaplet CLI

To set up snaplet with [npx](https://www.npmjs.com/package/npx), simply run:

```bash
npx snaplet setup
```

If you using yarn for your project and would like to add snaplet as a project dependency:

```bash
yarn add --dev snaplet
yarn snaplet setup
```

If you using npm for your project and would like to add snaplet as a project dependency:

```bash
npm install --dev snaplet
npx snaplet setup
```

Otherwise, if you'd like to install a standalone snaplet binary:

```bash
curl -sL https://app.snaplet.dev/get-cli/ | bash
snaplet setup
```

`snaplet setup` will ask you a few questions to get you set up, and generate a `snaplet.config.ts` configuration file for your project.

#### 2. Adding the database structure

Next, you'll need some structure in your database.

Usually, this is the step where you would make use of your project's _database migration tool_. For example, if you use [prisma](https://www.prisma.io/) in your project, you would run:

```bash
prisma migrate dev
```

`snaplet generate` makes use of your _target database_ (you would have provided this during`snaplet setup) to fetch the database structure, use this to figure out the generated data should look, and then populate this database with generated data.

#### 3. Configure `generate`

You'll then need to add configuration to your `snaplet.config.ts` file (generated by `snaplet setup`) to tell snaplet how to generate data:

```
// snaplet.config.ts

export default defineConfig({
  // add this section to your `defineConfig({})` in `snaplet.config.ts`
  generate: {
    plan({ snaplet }) {
      // if `Post` is a table in your database
      return snaplet.Post({
        count: 3
      });
    },
  },
});
```

At this point, you're ready to run your first `snaplet generate`!

```bash
# if you are using snaplet with npx or npm
npx snaplet generate

# if you are using snaplet with yarn
yarn snaplet generate

# if you are using the standalone snaplet binary
snaplet generate
```

As the config is at the moment, the generated data probably won't match what your application needs all too well. You'll need to tell snaplet how to generate data by adding to the generate `plan` in the `snaplet.config.ts` file. The next section covers how you would do this.

### Configure

Given the database schema:

<div style={{textAlign: 'center', marginBottom: '20px'}}>
    <img align="center" width="500" src="/img/snaplet-example-schema.png" alt="you branch?" />
</div>

Our requirements are:

- Creating a post with the title "There is a lot of snow around here!".
- The author of the post has an email that ends with "acme.org".
- This post receives 3 comments.

Here is what the plan looks like using the Snaplet Data Client:

```typescript title="snaplet.config.ts"
/// <reference path=".snaplet/snaplet.d.ts" />

import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {
      return snaplet.Post({
        data: {
          title: 'There is a lot of snow around here!',
          User: {
            data: {
              email: ({ seed }) => copycat.email(seed, { domain: 'acme.org' }),
            },
          },
          Comment: {
            count: 3,
          },
        },
      });
    },
  },
});
```

> We drew significant inspiration from our friends at [Prisma](https://www.prisma.io/). If you're familiar with Prisma, using the Snaplet Data Client will feel incredibly intuitive and seamless.

To see the SQL statements produced by your plan, run:

```bash
snaplet generate --sql
```

To execute these SQL statements against your configured target database, run:

:::warning

Be careful, this command will reset your database state, meaning that all your tables will be truncated

:::

```bash
snaplet generate
```

If you prefer to keep your existing data, you can use the `keep-data` option:

```bash
snaplet generate --keep-data
```

Here are the SQL statements generated by the Snaplet Data Client:

```sql
INSERT INTO public."User" (email, id, name) VALUES
-- This is the author of the post, notice the "acme.org" in the email
('Harold.Jast88421@acme.org', 'b8e07eae-5230-5193-a0ac-f2398d8a31e3', 'jampacked.mastoid32324'),
-- Those are the 3 users automatically generated to satisfy the 3 comments
('Narciso_Runolfsdottir15841@wallpaper-pine.info', '703e806b-1627-55c2-b24d-89fc7c38206f', 'boiling-measurement30380'),
('Finn.Douglas71373@tromp-midnight.biz', '01aa20af-4249-54af-b2fc-7aae61afe764', 'shoddy.throat26816'),
('Jaylon.Cartwright94743@infinitebillboard.net', '3a7b5218-ee17-5592-b13b-d8f54130dda7', 'perpetuate-pulley92958');

INSERT INTO public."Post" ("createdBy", content, id, title) VALUES
-- The post's title is correctly set to "There is a lot of snow around here!"
('b8e07eae-5230-5193-a0ac-f2398d8a31e3', 'Muva kakohymo va chimo sovikai rayukome havira, mimaviva soke vamikairae rae shimemuchi nivavimu ceasomeki mechi.', 'a492d66d-ca83-5bc0-a2eb-4f590e2797de', 'There is a lot of snow around here!');

INSERT INTO public."Comment" ("postId", "userId", content, id, "writtenAt") VALUES
-- The 3 comments are generated and linked automatically to the 3 users
('a492d66d-ca83-5bc0-a2eb-4f590e2797de', '703e806b-1627-55c2-b24d-89fc7c38206f', 'Yorae nomamea vamechima', '210a87ba-bafe-5e51-aa00-0fd5c6cfb76f', '2007-12-08T12:02:24.000Z'),
('a492d66d-ca83-5bc0-a2eb-4f590e2797de', '01aa20af-4249-54af-b2fc-7aae61afe764', 'Kekome kohachi', 'd7ee6e70-07ae-5ba7-9e6a-8c0d4d56ba05', '1981-06-26T17:45:37.000Z'),
('a492d66d-ca83-5bc0-a2eb-4f590e2797de', '3a7b5218-ee17-5592-b13b-d8f54130dda7', 'Kaishirae somema', 'f9a3f461-f31b-5e15-bcdb-2aa53622b635', '2002-07-03T06:42:44.000Z');
```

### Architecture and concepts

When generating data with the Snaplet Data Client, you are manipulating **plans**. A plan is a description of the data that you want to generate.

When a plan is executed, its internal **store** is populated with the generated data. A store is a simple in-memory map of your models containing arrays of generated values.

At the end of the process, the values contained in the store are turned into SQL statements.
